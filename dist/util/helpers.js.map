{"version":3,"sources":["../../src/util/helpers.js"],"names":["VIDEO","data","bestQuality","v","url_encoded_fmt_stream_map","url","type","caption_tracks","Array","isArray","n","i","length","src","encode","u","lc","parse","adaptive_fmts","parseURLSTR","afv_ad_tag","caption_translation_languages","str","obj"],"mappings":";;;;;;;;;AAAA;;;;AACA;;;;;;;;IACaA,K,WAAAA,K;AACX,iBAAYC,IAAZ,EAAiB;AAAA;;AAAA;;AAAA,SAajBC,WAbiB,GAaH,YAAM;AAClB;AACA,UAAIC,uDACa,MAAKF,IAAL,CAAUG,0BAAV,CAAqCC,GAArC,CAAyC,CAAzC,CADb,gCAEc,MAAKJ,IAAL,CAAUG,0BAAV,CAAqCE,IAArC,CAA0C,CAA1C,CAFd,SAAJ;AAGE;AACF,UAAG,MAAKL,IAAL,CAAUM,cAAb,EAA4B;AAC1B,YAAGC,MAAMC,OAAN,CAAc,MAAKR,IAAL,CAAUM,cAAV,CAAyBG,CAAvC,CAAH,EAA6C;AAC3C,eAAI,IAAIC,IAAE,CAAV,EAAYA,IAAE,MAAKV,IAAL,CAAUM,cAAV,CAAyBG,CAAzB,CAA2BE,MAAzC,EAAgDD,GAAhD,EAAoD;AAClD,gBAAGA,MAAI,CAAP,EAAS;AACP,kBAAIE,MAAM,eAAOC,MAAP,CAAc,MAAKb,IAAL,CAAUM,cAAV,CAAyBQ,CAAzB,CAA2BJ,CAA3B,IAA8B,qBAA5C,CAAV;AACAR,sCAAqB,MAAKF,IAAL,CAAUM,cAAV,CAAyBG,CAAzB,CAA2BC,CAA3B,CAArB,oCAAiF,MAAKV,IAAL,CAAUM,cAAV,CAAyBS,EAAzB,CAA4BL,CAA5B,CAAjF,yBAAmIE,GAAnI;AACD,aAHD,MAGK;AACH,kBAAIA,OAAM,eAAOC,MAAP,CAAc,MAAKb,IAAL,CAAUM,cAAV,CAAyBQ,CAAzB,CAA2BJ,CAA3B,IAA8B,qBAA5C,CAAV;AACAR,sCAAqB,MAAKF,IAAL,CAAUM,cAAV,CAAyBG,CAAzB,CAA2BC,CAA3B,CAArB,oCAAiF,MAAKV,IAAL,CAAUM,cAAV,CAAyBS,EAAzB,CAA4BL,CAA5B,CAAjF,yBAAmIE,IAAnI;AACD;AACF;AACF,SAVD,MAUK;AACH,cAAIA,QAAM,eAAOC,MAAP,CAAc,MAAKb,IAAL,CAAUM,cAAV,CAAyBQ,CAAzB,GAA2B,qBAAzC,CAAV;AACAZ,kCAAqB,MAAKF,IAAL,CAAUM,cAAV,CAAyBG,CAA9C,oCAA8E,MAAKT,IAAL,CAAUM,cAAV,CAAyBS,EAAvG,yBAA6HH,KAA7H;AACD;AACF;AACDV;AACA,aAAOA,CAAP;AACD,KArCgB;;AACf,SAAKF,IAAL,GAAY,sBAAYgB,KAAZ,CAAkBhB,IAAlB,CAAZ;AACA,QAAG,KAAKA,IAAL,CAAUiB,aAAb,EAA2B,KAAKjB,IAAL,CAAUiB,aAAV,GAA0B,KAAKC,WAAL,CAAiB,KAAKlB,IAAL,CAAUiB,aAA3B,CAA1B;AAC3B,QAAG,KAAKjB,IAAL,CAAUG,0BAAb,EAAwC,KAAKH,IAAL,CAAUG,0BAAV,GAAuC,KAAKe,WAAL,CAAiB,KAAKlB,IAAL,CAAUG,0BAA3B,CAAvC;AACxC,QAAG,KAAKH,IAAL,CAAUmB,UAAb,EAAwB,KAAKnB,IAAL,CAAUmB,UAAV,GAAuB,KAAKD,WAAL,CAAiB,KAAKlB,IAAL,CAAUmB,UAA3B,CAAvB;AACxB,QAAG,KAAKnB,IAAL,CAAUM,cAAb,EAA4B,KAAKN,IAAL,CAAUM,cAAV,GAA2B,KAAKY,WAAL,CAAiB,KAAKlB,IAAL,CAAUM,cAA3B,CAA3B;AAC5B,QAAG,KAAKN,IAAL,CAAUoB,6BAAb,EAA2C,KAAKpB,IAAL,CAAUoB,6BAAV,GAA0C,KAAKF,WAAL,CAAiB,KAAKlB,IAAL,CAAUoB,6BAA3B,CAA1C;AAC3C;AACD;;;;gCACWC,G,EAAI;AACd,UAAIC,MAAM,sBAAYN,KAAZ,CAAkBK,GAAlB,CAAV;AACA,aAAOC,GAAP;AACD","file":"helpers.js","sourcesContent":["import querystring from 'querystring';\nimport base64 from 'base-64';\nexport class VIDEO {\n  constructor(data){\n    this.data = querystring.parse(data);\n    if(this.data.adaptive_fmts)this.data.adaptive_fmts = this.parseURLSTR(this.data.adaptive_fmts);\n    if(this.data.url_encoded_fmt_stream_map)this.data.url_encoded_fmt_stream_map = this.parseURLSTR(this.data.url_encoded_fmt_stream_map);\n    if(this.data.afv_ad_tag)this.data.afv_ad_tag = this.parseURLSTR(this.data.afv_ad_tag);\n    if(this.data.caption_tracks)this.data.caption_tracks = this.parseURLSTR(this.data.caption_tracks);\n    if(this.data.caption_translation_languages)this.data.caption_translation_languages = this.parseURLSTR(this.data.caption_translation_languages);\n    // return this.data;\n  }\n  parseURLSTR(str){\n    let obj = querystring.parse(str);\n    return obj;\n  }\n  bestQuality = () => {\n    //add #t=[start_time][,end_time] to the media URL.\n    let v = `<video controls autoplay>\n      <source src=\"${this.data.url_encoded_fmt_stream_map.url[0]}\"\n              type='${this.data.url_encoded_fmt_stream_map.type[0]}'/>`;\n      // v += `<track kind=\"subtitles\" label=\"Italian\" srclang=\"it\" src=\"https://m.youtube.com/api/timedtext?sparams=asr_langs%2Ccaps%2Cv%2Cexpire&amp;signature=05ED52879297D56CE654812BAD0135D819C71391.7CB95227425238C954573B04A51310857D65E438&amp;asr_langs=ru%2Cko%2Cen%2Cpt%2Cde%2Cja%2Cit%2Cfr%2Cnl%2Ces&amp;hl=en-US&amp;expire=1475730347&amp;key=yttt1&amp;v=2QOx7vmjV2E&amp;caps=asr&amp;type=track&amp;lang=it&amp;name&amp;kind&amp;fmt=vtt\">`;\n    if(this.data.caption_tracks){\n      if(Array.isArray(this.data.caption_tracks.n)){\n        for(let i=0;i<this.data.caption_tracks.n.length;i++){\n          if(i===0){\n            let src = base64.encode(this.data.caption_tracks.u[i]+'&fmt=vtt&type=track');\n            v+= `<track label=\"${this.data.caption_tracks.n[i]}\" kind=\"subtitles\" srclang=\"${this.data.caption_tracks.lc[i]}\" src=\"/pipe?url=${src}\" default>`;\n          }else{\n            let src = base64.encode(this.data.caption_tracks.u[i]+'&fmt=vtt&type=track');\n            v+= `<track label=\"${this.data.caption_tracks.n[i]}\" kind=\"subtitles\" srclang=\"${this.data.caption_tracks.lc[i]}\" src=\"/pipe?url=${src}\">`;\n          }\n        }\n      }else{\n        let src = base64.encode(this.data.caption_tracks.u+'&fmt=vtt&type=track');\n        v+= `<track label=\"${this.data.caption_tracks.n}\" kind=\"subtitles\" srclang=\"${this.data.caption_tracks.lc}\" src=\"/pipe?url=${src}\" default>`;\n      }\n    }\n    v += `</video>`;\n    return v;\n  }\n}\n"]}